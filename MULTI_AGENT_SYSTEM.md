# Мультиагентная система анализа цепочки ценности

## Обзор

Система реализует мультиагентную архитектуру для анализа бизнес-процессов и поиска узких мест в цепочке ценности. Использует специализированных агентов, которые работают совместно для глубокого анализа и предложения решений.

## Архитектура

### Агенты

1. **Manager-агент (Value Chain Advisor)**
   - Оркестратор системы
   - Ведет диалог с пользователем
   - Задает вопросы для сегментации цепочки ценности
   - Планирует работу подагентов
   - Собирает результаты в понятный формат

2. **Process Mining агент**
   - Структурирует описание процессов
   - Создает карту цепочки ценности
   - Определяет этапы, входы, выходы, участников
   - Собирает метрики (время цикла, частота проблем, загрузка ресурсов)

3. **Bottleneck агент**
   - Анализирует карту процессов
   - Ищет узкие места по критериям:
     - Максимальное время цикла
     - Высокая загрузка ресурсов (>80%)
     - Накопление очередей
     - Высокая частота проблем
   - Оценивает влияние на throughput

4. **Re-design агент**
   - Предлагает варианты пересборки процессов
   - Генерирует roadmap (MVP на 2-4 недели и долгосрочные)
   - Определяет необходимых агентов-исполнителей
   - Описывает технические требования

## Фазы работы

1. **initialization** - Сегментация цепочки ценности
   - Manager задает 5-10 высокоуровневых вопросов
   - Собирает информацию о продукте, этапах, ролях, KPI

2. **process_mapping** - Построение карты процессов
   - Process Mining агент структурирует собранную информацию
   - Создает карту с этапами и метриками

3. **bottleneck_analysis** - Анализ узких мест
   - Bottleneck агент анализирует карту
   - Находит 3-5 критических узких мест
   - Оценивает влияние и приоритеты

4. **solution_design** - Проектирование решений
   - Re-design агент предлагает решения
   - Создает roadmap и определяет агентов-исполнителей

5. **complete** - Завершение
   - Система выдает финальный отчет

## Использование

### API

#### Инициализация
```typescript
POST /api/multi-agent
{
  "businessData": {
    "productDescription": "...",
    "teamSize": 10,
    "workflows": "...",
    "kpis": "..."
  }
}
```

#### Отправка сообщения
```typescript
POST /api/multi-agent
{
  "businessData": {...},
  "userMessage": "ответ пользователя",
  "multiAgentState": {...}
}
```

### Компоненты

#### MultiAgentChat
Компонент для отображения диалога с мультиагентной системой.

```tsx
<MultiAgentChat
  multiAgentState={multiAgentState}
  isLoading={isLoading}
  onSendMessage={handleSendMessage}
  onInitialize={handleInitialize}
  isInitializing={isInitializing}
/>
```

## Структура файлов

```
src/
  lib/
    agents/
      managerAgent.ts          # Manager-агент
      processMiningAgent.ts    # Process Mining агент
      bottleneckAgent.ts       # Bottleneck агент
      redesignAgent.ts         # Re-design агент
      multiAgentGraph.ts       # Граф оркестрации
  components/
    MultiAgentChat.tsx         # UI компонент
  app/
    api/
      multi-agent/
        route.ts              # API endpoint
  types/
    index.ts                  # Типы для мультиагентной системы
```

## Типы данных

### MultiAgentState
Состояние мультиагентной системы:
- `phase`: текущая фаза работы
- `businessData`: данные о бизнесе
- `valueChainMap`: карта цепочки ценности
- `agentMessages`: сообщения от агентов
- `currentQuestion`: текущий вопрос к пользователю
- `collectedAnswers`: собранные ответы
- `bottlenecks`: найденные узкие места
- `isComplete`: завершена ли работа

### ValueChainMap
Карта цепочки ценности:
- `id`: уникальный идентификатор
- `productDescription`: описание продукта
- `steps`: массив этапов процесса
- `createdAt`, `updatedAt`: временные метки

### ProcessStep
Этап процесса:
- `id`, `name`, `description`
- `inputs`, `outputs`: входы и выходы
- `participants`: участники
- `cycleTime`: время цикла
- `problemFrequency`: частота проблем
- `queueSize`: размер очереди
- `utilization`: загрузка ресурса
- `isBottleneck`: является ли узким местом

## Особенности

1. **Диалоговый режим**: система сама задает вопросы и уточняет информацию
2. **Автоматическое планирование**: Manager-агент планирует работу подагентов
3. **Структурированный анализ**: Process Mining создает детальную карту
4. **Обоснованные выводы**: Bottleneck агент использует критерии из Theory of Constraints
5. **Практичные решения**: Re-design агент предлагает реализуемые roadmap

## Интеграция

Система интегрирована в главную страницу приложения. По умолчанию используется мультиагентная система (`useMultiAgent = true`).

При переходе на этап `bottlenecks`:
1. Если мультиагентная система не инициализирована - показывается компонент для инициализации
2. После инициализации - показывается диалог с системой
3. Когда найдены узкие места - они отображаются в списке слева
4. При выборе узкого места - показываются детали и возможность диалога

## Расширение

Для добавления новых агентов:
1. Создать класс агента в `src/lib/agents/`
2. Добавить тип агента в `AgentType`
3. Интегрировать в `MultiAgentGraph`
4. Обновить UI для отображения нового агента

